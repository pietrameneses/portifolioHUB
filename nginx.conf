# Define o usuário que irá executar os processos do Nginx. 
# 'nginx' é o usuário padrão na imagem Docker oficial e é uma boa prática de segurança.
user nginx;

# Define o número de processos de trabalho (worker). 
# 'auto' instrui o Nginx a detectar o número ideal de núcleos de CPU disponíveis.
worker_processes auto;

# Arquivo onde o ID do processo principal (PID) do Nginx será armazenado.
pid /var/run/nginx.pid;

# Define o arquivo de log de erro global e o nível de severidade (ex: debug, info, notice, warn, error).
error_log /var/log/nginx/error.log warn;


# Bloco de configuração para eventos de rede.
events {
    # Número máximo de conexões simultâneas que cada processo de trabalho pode manipular.
    worker_connections 1024;
}


# Bloco principal de configuração para o tráfego HTTP.
http {
    # Inclui um arquivo que mapeia as extensões de arquivo para os tipos MIME correspondentes.
    # Isso informa ao navegador como interpretar cada arquivo (ex: .html é text/html).
    include       /etc/nginx/mime.types;
    # Define o tipo de arquivo padrão se o tipo MIME não puder ser determinado.
    default_type  application/octet-stream;

    charset utf-8;

    # Define o formato do log de acesso. O nome 'main' é uma convenção comum.
    # Cada variável ($remote_addr, etc.) representa uma informação sobre a requisição.
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    # Define o local do arquivo de log de acesso, usando o formato 'main' definido acima.
    access_log  /var/log/nginx/access.log  main;

    # ================== Otimizações de Performance ==================

    # Permite o uso da chamada de sistema sendfile() para transferir arquivos de forma mais eficiente.
    sendfile        on;

    # Otimiza o envio de pacotes de rede, enviando todos os cabeçalhos em um único pacote.
    tcp_nopush      on;

    # Tempo em segundos que uma conexão keep-alive com o cliente permanecerá aberta.
    # Isso evita o custo de abrir e fechar conexões para cada requisição.
    keepalive_timeout  65;

    # Ativa a compressão Gzip para reduzir o tamanho dos dados transferidos (HTML, CSS, JS).
    gzip  on;

    # ===================================================================
    #         Configuração do Servidor Web (Virtual Host)
    # ===================================================================
    # Este é o bloco que define como seu site específico será servido.
    server {
        # Escuta na porta 80 para tráfego IPv4 e IPv6.
        # 'default_server' faz com que este bloco seja o padrão para qualquer requisição
        # que chegue a este IP e porta, caso o domínio não corresponda a outro bloco 'server'.
        listen       80 default_server;
        listen       [::]:80 default_server;

        # O nome do servidor (domínio). Para desenvolvimento local, 'localhost' é perfeito.
        # Em produção, seria algo como 'meuportfolio.com' ou 'www.meuportfolio.com'.
        server_name  localhost;

        # O diretório raiz onde os arquivos do seu site (index.html, etc.) estão localizados DENTRO do container.
        # Este caminho corresponde ao destino do comando 'COPY' no seu Dockerfile.
        root         /usr/share/nginx/html;

        # Define os arquivos que serão procurados quando o cliente requisita um diretório.
        # Nginx tentará servir 'index.html' primeiro, e depois 'index.htm'.
        index        index.html index.htm;

        # Bloco de localização que captura todas as requisições ('/').
        location / {
            # Tenta servir o arquivo requisitado.
            # 1. $uri: Tenta encontrar um arquivo com o nome exato (ex: /imagens/logo.png).
            # 2. $uri/: Se não for um arquivo, tenta ver se é um diretório (e serve o arquivo 'index' dele).
            # 3. =404: Se nenhuma das opções anteriores funcionar, retorna o erro 404 (Não Encontrado).
            try_files $uri $uri/ =404;
        }

        # Redireciona códigos de erro do servidor para uma página de erro estática personalizada (boa prática).
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    }
    # Se você quisesse hospedar um segundo site no mesmo Nginx, você simplesmente
    # adicionaria outro bloco 'server { ... }' completo aqui.
}
